steps:
#  - template: keyvault-read.yaml
#    parameters:
#      serviceConnection: $(serviceConnection)
#      environment: ${{ parameters.environment }}

  - task: PowerShell@2
    displayName: Set terraform version env variable
    inputs:
      targetType: 'inline'
      script: |
        $tfVersion = Get-Content "$(System.DefaultWorkingDirectory)/.terraform-version" -Raw
        Write-Host "##vso[task.setvariable variable=tfVersion]$tfVersion"
      
  - task: TerraformInstaller@0
    displayName: 'Install Terraform $(tfversion)'
    inputs:
      terraformVersion: $(tfversion)

  - task: TerraformCLI@0
    displayName: 'Terraform init'
    inputs:
      command: 'init'
      commandOptions: '-backend=false -input=false'
      workingDirectory: '$(System.DefaultWorkingDirectory)'
